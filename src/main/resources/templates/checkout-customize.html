<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customize Your Order</title>
    <link rel="stylesheet" th:href="@{/style.css}" href="../static/style.css"></head>
</head>
<body>

<header>
    <h1>Checkout Addons</h1>
</header>

<div class="container">
    <a th:href="@{/cart}" class="back-link">‚Üê Back to Cart</a>

    <div class="content">
        <form th:action="@{/checkout/preview}" method="post">
            <div th:if="${cart != null and not #lists.isEmpty(cart.items)}">
                <div th:each="decoratedProduct, iterStat : ${decoratedProducts}" class="cart-item">
                    <div class="item-header">
                        <span class="item-name" th:text="${decoratedProduct.description}">Product Name</span>
                        <span class="item-price" th:with="lineTotal=${decoratedProduct.price * cart.items[iterStat.index].quantity}">
                            $<span th:text="${#numbers.formatDecimal(lineTotal, 0, 'COMMA', 2, 'POINT')}">0.00</span>
                        </span>
                    </div>

                    <div class="item-details">
                        Quantity: <span th:text="${cart.items[iterStat.index].quantity}">1</span> √ó
                        $<span th:text="${#numbers.formatDecimal(decoratedProduct.price, 0, 'COMMA', 2, 'POINT')}">0.00</span>
                    </div>

                    <div class="customization-section">
                        <div class="customization-title">Customize This Item</div>

                        <div class="option-group">
                            <label class="option-label">
                                <input type="checkbox"
                                       th:name="'giftWrap_' + ${cart.items[iterStat.index].id}"
                                       value="true">
                                <span class="option-text">
                                    <span class="option-name">Gift Wrapping</span>
                                </span>
                                <span class="option-price">+$5.00</span>
                            </label>
                        </div>

                        <div class="option-group">
                            <label class="option-label" th:onclick="'toggleWarranty(' + ${cart.items[iterStat.index].id} + ')'">
                                <input type="checkbox"
                                       th:id="'warranty_check_' + ${cart.items[iterStat.index].id}"
                                       onclick="event.stopPropagation();"
                                       th:onchange="'toggleWarrantyOptions(' + ${cart.items[iterStat.index].id} + ')'">
                                <span class="option-text">
                                    <span class="option-name">Extended Warranty</span>
                                </span>
                                <span class="option-price">$10/year</span>
                            </label>

                            <div th:id="'warranty_options_' + ${cart.items[iterStat.index].id}" class="warranty-options">
                                <label class="option-label">
                                    <input type="radio"
                                           th:name="'warranty_' + ${cart.items[iterStat.index].id}"
                                           value="1">
                                    <span class="option-text">   1 Year Warranty (+$10.00)</span>
                                </label>
                                <label class="option-label">
                                    <input type="radio"
                                           th:name="'warranty_' + ${cart.items[iterStat.index].id}"
                                           value="2">
                                    <span class="option-text">   2 Year Warranty (+$20.00)</span>
                                </label>
                                <label class="option-label">
                                    <input type="radio"
                                           th:name="'warranty_' + ${cart.items[iterStat.index].id}"
                                           value="3">
                                    <span class="option-text">   3 Year Warranty (+$30.00)</span>
                                </label>
                            </div>
                        </div>

                        <div class="option-group">
                            <label class="option-label" th:onclick="'toggleDiscount(' + ${cart.items[iterStat.index].id} + ')'">
                                <input type="checkbox"
                                       th:id="'discount_check_' + ${cart.items[iterStat.index].id}"
                                       onclick="event.stopPropagation();"
                                       th:onchange="'toggleDiscountOptions(' + ${cart.items[iterStat.index].id} + ')'">
                                <span class="option-text">
                                    <span class="option-name">Apply Discount</span>
                                </span>
                            </label>

                            <div th:id="'discount_options_' + ${cart.items[iterStat.index].id}" class="discount-options">
                                <label class="option-label">
                                    <input type="radio"
                                           th:name="'discount_' + ${cart.items[iterStat.index].id}"
                                           value="5">
                                    <span class="option-text">   5% Off</span>
                                </label>
                                <label class="option-label">
                                    <input type="radio"
                                           th:name="'discount_' + ${cart.items[iterStat.index].id}"
                                           value="10">
                                    <span class="option-text">   10% Off</span>
                                </label>
                                <label class="option-label">
                                    <input type="radio"
                                           th:name="'discount_' + ${cart.items[iterStat.index].id}"
                                           value="15">
                                    <span class="option-text">   15% Off</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="actions">
                    <a th:href="@{/cart}" class="btn btn-secondary">Cancel</a>
                    <button type="submit" class="btn btn-primary">Continue to Payment ‚Üí</button>
                </div>
            </div>

            <div th:if="${cart == null or #lists.isEmpty(cart.items)}" class="empty-cart">
                <div class="empty-cart-icon">üõí</div>
                <p>Your cart is empty</p>
                <a th:href="@{/shop}" class="btn btn-primary" style="margin-top: 20px;">Start Shopping</a>
            </div>
        </form>
    </div>
</div>

<script>
    function toggleWarrantyOptions(itemId) {
        const checkbox = document.getElementById('warranty_check_' + itemId);
        const options = document.getElementById('warranty_options_' + itemId);

        if (checkbox.checked) {
            options.classList.add('active');
            const firstRadio = options.querySelector('input[type="radio"]');
            if (firstRadio) firstRadio.checked = true;
        } else {
            options.classList.remove('active');
            options.querySelectorAll('input[type="radio"]').forEach(radio => radio.checked = false);
        }
    }

    function toggleWarranty(itemId) {
        const checkbox = document.getElementById('warranty_check_' + itemId);
        checkbox.checked = !checkbox.checked;
        toggleWarrantyOptions(itemId);
    }

    function toggleDiscountOptions(itemId) {
        const checkbox = document.getElementById('discount_check_' + itemId);
        const options = document.getElementById('discount_options_' + itemId);

        if (checkbox.checked) {
            options.classList.add('active');
            const firstRadio = options.querySelector('input[type="radio"]');
            if (firstRadio) firstRadio.checked = true;
        } else {
            options.classList.remove('active');
            options.querySelectorAll('input[type="radio"]').forEach(radio => radio.checked = false);
        }
    }

    function toggleDiscount(itemId) {
        const checkbox = document.getElementById('discount_check_' + itemId);
        checkbox.checked = !checkbox.checked;
        toggleDiscountOptions(itemId);
    }
</script>

</body>
</html>